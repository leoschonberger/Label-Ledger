<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Ledger</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
    <script>
        async function handleScrape(event) {
            event.preventDefault();
            const website = document.getElementById('website').value;

            // Show a loading message
            const scrapeResultElement = document.getElementById('scrape-result');
            scrapeResultElement.textContent = 'Scraping in progress... Please wait.';

            const response = await fetch('/scrape', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ website })
            });

            const result = await response.json();

            if (response.ok) {
                scrapeResultElement.textContent = JSON.stringify(result.chunks, null, 2);
                document.getElementById('chunks').value = JSON.stringify(result.chunks);
                document.getElementById('parse-section').style.display = 'block';
            } else {
                scrapeResultElement.textContent = '';
                alert(`Error: ${result.error}`);
            }
        }

        async function handleParse(event) {
            event.preventDefault();
            const chunks = document.getElementById('chunks').value;
            const parseDescription = document.getElementById('parse_description').value;

            // Show a loading message
            const parseResultElement = document.getElementById('parse-result');
            parseResultElement.textContent = 'Parsing in progress... Please wait.';

            const response = await fetch('/parse', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chunks: JSON.parse(chunks), parse_description: parseDescription })
            });

            const result = await response.json();

            if (response.ok) {
                parseResultElement.textContent = result.parsed_content;
            } else {
                parseResultElement.textContent = '';
                alert(`Error: ${result.error}`);
            }
        }
    </script>
</head>

<body>
    <h1>Welcome to Label Ledger</h1>

    <!-- Scrape Section -->
    <form id="scrape-form" onsubmit="handleScrape(event)">
        <h2>Scrape a Website</h2>
        <label for="website">Website URL:</label>
        <input type="text" id="website" name="website" required>
        <button type="submit">Scrape</button>
    </form>
    <pre id="scrape-result" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px; margin-top: 10px;"></pre>

    <!-- Parse Section (Initially Hidden) -->
    <div id="parse-section" style="display: none;">
        <form id="parse-form" onsubmit="handleParse(event)">
            <h2>Parse Content</h2>
            <label for="chunks">Chunks:</label>
            <textarea id="chunks" name="chunks" readonly required></textarea>
            <label for="parse_description">Parse Description:</label>
            <input type="text" id="parse_description" name="parse_description" required>
            <button type="submit">Parse</button>
        </form>
        <pre id="parse-result" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px; margin-top: 10px;"></pre>
    </div>
</body>
</html>
